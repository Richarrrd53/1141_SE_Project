<section class="content-area" id="contentArea">
    <h1>{{ project.title }}</h1>
    
    <table id="project-info">
        <tr>
            <th>å§”è¨—äººï¼š{{ project.client_username }}</th>
            <th>ç™¼å¸ƒæ—¥æœŸï¼š{{ project.create_time.strftime('%Y-%m-%d') }}</th>
            <th>æˆªæ­¢æ—¥æœŸï¼š{{ project.deadline_date.strftime('%Y-%m-%d') if project.deadline_date else 'N/A' }}</th>
            <th><span class="status-pill link-{{project.status}}">{{ project.status_text }}</span></th>
        </tr>
    </table>
    
    {% if project.accepted_freelancer_username %}
        <p><strong>å·²æ‰¿æ¥ï¼š</strong> {{ project.accepted_freelancer_username }}</p>
    {% endif %}

    {% if role == 'client' and project.status == 'in_progress' %}
        <h3>æ‚¨å·²åŒæ„ {{ project.accepted_freelancer_username }} æ¥æ¡ˆï¼Œè«‹ç­‰å€™æ¥æ¡ˆäººäº¤ä»˜æª”æ¡ˆã€‚</h3>
    
    {% elif role == 'client' and project.status == 'delivered' %}
        <hr>
        <h3>çµæ¡ˆç®¡ç†</h3>
        <p>æ¥æ¡ˆäºº ({{ project.accepted_freelancer_username }}) å·²äº¤ä»˜æª”æ¡ˆï¼Œè«‹ä¸‹è¼‰å¯©æ ¸ï¼š</p>
        
        <a href="/{{ project.delivery_file_path }}" target="_blank" class="btn btn-download">
            <img src="./img/download.svg" class="icon" alt="">ä¸‹è¼‰çµæ¡ˆæª”æ¡ˆ
        </a>
        
        <div class="btnContainer" style="justify-content: flex-start; margin-top: 20px;">
            <button class="btn btn-danger" onclick='notifyWindow("ç¢ºå®šè¦é€€ä»¶ï¼Ÿ(å°ˆæ¡ˆå°‡é€€å›é€²è¡Œä¸­)", "ç¢ºèªé€€ä»¶", "reject_delivery", {{ project.id }}, true);'>
                é€€ä»¶
            </button>
            <button class="btn btn-success" onclick='notifyWindow("ç¢ºèªæ¥å—æ­¤çµæ¡ˆæª”æ¡ˆï¼Ÿ(å°ˆæ¡ˆå°‡çµæ¡ˆ)", "æ¥å—çµæ¡ˆ", "accept_delivery", {{ project.id }}, false);'>
                æ¥å—çµæ¡ˆ
            </button>
        </div>
    
    {% elif role == 'client' and project.status == 'completed'%}
        <p>æ¥æ¡ˆäºº ({{ project.accepted_freelancer_username }}) å·²äº¤ä»˜æª”æ¡ˆï¼Œä¸¦çµæ¡ˆï¼š</p>
        <a href="/{{ project.delivery_file_path }}" target="_blank" class="btn btn-download">
            <img src="./img/download.svg" class="icon" alt="">ä¸‹è¼‰çµæ¡ˆæª”æ¡ˆ
        </a>

    {% elif role == 'client' and project.status == 'rejected'%}
        <h3 class="text-danger">æ‚¨å·²é€€ä»¶ {{ project.accepted_freelancer_username }} çš„æª”æ¡ˆï¼Œè«‹ç­‰å€™æ¥æ¡ˆäººé‡æ–°äº¤ä»˜ã€‚</h3>
    {% endif %}

    <hr>
    
    <div>
        <strong>é ç®—ï¼š</strong> ${{ project.budget }}
    </div>
    <div>
        <strong>éœ€æ±‚æè¿°ï¼š</strong>
        <p style="white-space: pre-wrap;">{{ project.content }}</p>
    </div>

    {% if role == 'client' %}
    <hr>
    <h3>æ”¶åˆ°çš„å ±åƒ¹ ({{ bids | length }} å‰‡)</h3>
    {% if bids %}
        <table id="contentTable">
            <thead>
                <tr>
                    <th style="font-weight: bold; padding: 10px;">ææ¡ˆè€…</th>
                    <th style="font-weight: bold; padding: 10px;">å ±åƒ¹</th>
                    <th style="font-weight: bold; padding: 10px;">ç•™è¨€</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for bid in bids %}
                <tr>
                    <td>{{ bid.freelancer_username }}</td>
                    <td>${{ bid.bid_amount }}</td>
                    <td>{{ bid.message }}</td>
                    <td>
                        {% if project.status == 'open' %}
                            <button class="btn btn-primary" onclick='notifyWindow("ç¢ºå®šè¦æ¥å—æ­¤å ±åƒ¹ï¼Ÿ (å°ˆæ¡ˆå°‡é–å®šä¸¦é–‹å§‹)", "æ¥å—", "accept_bid", {{ bid.id }}, false);'>
                                æ¥å—æ­¤å ±åƒ¹
                            </button>
                        {% elif bid.status == 'accepted' %}
                            <span class="status-pill link-open">å·²æ¥å—</span>
                        {% elif bid.status == 'rejected' %}
                            <span class="status-pill link-rejected">å·²æ‹’çµ•</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>ç›®å‰å°šç„¡å ±åƒ¹ã€‚</p>
    {% endif %}

    {% elif role == 'freelancer' and project.status == 'open' %}
        <hr>
        {%if is_bid_exist == False%}
            <h3>æœ‰æ„é¡˜æ‰¿åŒ…å—ï¼Ÿè«‹æå‡ºæ‰¿åŒ…æ„é¡˜ (å ±åƒ¹)</h3>
            <form id="create-bid-form">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <div class="form-group">
                    <label for="bid_amount">æ‚¨çš„å ±åƒ¹ (TWD):</label>
                    <input type="number" id="bid_amount" name="bid_amount" required>
                </div>
                <div class="form-group">
                    <label for="message">ç•™è¨€ (å‘Šè¨´å§”è¨—äººæ‚¨ç‚ºä»€éº¼é©åˆï¼Œé¸å¡«):</label>
                    <textarea id="message" name="message" rows="4"></textarea>
                </div>
                <button type="button" class="btn btn-primary" id="submitBidBtn" onclick='notifyWindow("æ˜¯å¦ç¢ºèªé€å‡ºé€™å‰‡å ±åƒ¹ï¼Ÿ", "é€å‡º", "sendBid", 0, false);'>é€å‡ºå ±åƒ¹</button>
            </form>
        {%elif is_bid_exist == True and bid_status == 'pending'%}
            <h3 class="text-warning">æ‚¨å·²æéå ±åƒ¹ï¼Œè«‹è€å¿ƒç­‰å¾…å§”è¨—äººæ¥å—ã€‚</h3>
        {%elif is_bid_exist == True and bid_status == 'rejected'%}
            <h3 class="text-danger">å¾ˆæŠ±æ­‰ï¼Œå§”è¨—äººå·²æ‹’çµ•ä½ çš„å ±åƒ¹ï¼Œå†æ¥å†å²ã€‚</h3>
        {%endif%}
    
    {% elif role == 'freelancer' and project.status in ['in_progress', 'rejected'] and current_user == project.accepted_freelancer_username %}
        <hr>
        {% if project.status == 'rejected' %}
            <h3 class="text-danger">å§”è¨—äººå·²é€€ä»¶ï¼Œè«‹é‡æ–°ä¸Šå‚³æª”æ¡ˆ</h3>
            <p>è«‹é‡æ–°ä¸Šå‚³æ‚¨çš„å°ˆæ¡ˆæˆæœï¼Œå§”è¨—äººå°‡æœƒé€²è¡Œå¯©æ ¸ã€‚</p>
        {% else %}
            <h3>ä¸Šå‚³çµæ¡ˆæª”æ¡ˆ</h3>
            <p>è«‹ä¸Šå‚³æ‚¨çš„å°ˆæ¡ˆæˆæœï¼Œå§”è¨—äººå°‡æœƒé€²è¡Œå¯©æ ¸ã€‚</p>
        {% endif %}
        
        <form id="deliver-project-form">
            <input type="hidden" id="project_id_for_delivery" value="{{ project.id }}">
            <div class="form-group">
                <label for="delivery_file">é¸æ“‡æª”æ¡ˆ (.zip, .pdf, .jpg...):</label>
                <input type="file" id="delivery_file" name="delivery_file" required>
            </div>
            <button type="button" class="btn btn-primary" id="submitDeliveryBtn" onclick='notifyWindow("æ˜¯å¦ä¸Šå‚³æª”æ¡ˆ", "ä¸Šå‚³", "upload", {{project.id}}, false);'>ä¸Šå‚³çµæ¡ˆ</button>
        </form>
    
    {% elif role == 'freelancer' and project.status == 'delivered' %}
        <h3 style="color: #0077b6;">æ‚¨å·²ä¸Šå‚³çµæ¡ˆæª”æ¡ˆï¼Œè«‹ç­‰å¾…å§”è¨—äººå¯©æ ¸ã€‚</h3>
        
    {% elif role == 'freelancer' and project.status == 'completed' %}
        <h3 style="color: #4CAF50;">ğŸ‰ æ­å–œï¼å°ˆæ¡ˆå·²çµæ¡ˆã€‚</h3>
    {% endif %}

    <div class="btnContainer" style="justify-content: flex-start; margin-top: 2rem;">
        {% if role == 'client' and project.status != 'completed'%}
            <button class="btn btn-secondary" onclick="loadContent('/page/my-projects'); return false;">
                è¿”å›åˆ—è¡¨
            </button>
            <button class="btn btn-primary" onclick="loadContent('/page/my-projects/edit-form/{{ project.id }}'); return false;">
                ç·¨è¼¯å°ˆæ¡ˆ
            </button>
        {% elif role == 'client' and project.status == 'completed' %}
            <button class="btn btn-secondary" onclick="loadContent('/page/my-projects'); return false;">
                è¿”å›åˆ—è¡¨
            </button>
        {% elif role == 'freelancer' and project.status == 'open' %}
            <button class="btn btn-secondary" onclick="loadContent('/page/browse-projects'); return false;">
                è¿”å›åˆ—è¡¨
            </button>
        {% else %}
            <button class="btn btn-secondary" onclick="tempPage = 0; menuLinkClick(6);">
                è¿”å›åˆ—è¡¨
            </button>
        {% endif %}
    </div>
</section>

<div id="loading">
    <div class="jelly-triangle">
        <div class="jelly-triangle__dot"></div>
        <div class="jelly-triangle__traveler"></div>
    </div>
    <svg width="0" height="0" class="jelly-maker">
        <defs>
            <filter id="uib-jelly-triangle-ooze">
                <feGaussianBlur in="SourceGraphic" stdDeviation="7.3" result="blur"></feGaussianBlur>
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="ooze"></feColorMatrix>
                <feBlend in="SourceGraphic" in2="ooze"></feBlend>
            </filter>
        </defs>
    </svg>
    <div class="loading-text" id="loadingText">è«‹ç¨å¾Œ...</div>
</div>